<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>GMail Backup (GMVault)</title>
    <link rel="canonical" href="http://notebook.craigpaton.uk/synology/gmvault.html" />
    <link rel="stylesheet" type="text/css" href="/css/bootstrap.css" media="screen">
    <link rel="stylesheet" type="text/css" href="/css/customisation.css" media="screen">
    <link rel="stylesheet" type="text/css" href="/css/solarized-dark.css" media="screen">
</head>
<body data-spy="scroll" data-target="#toc">
    <nav id="header-nav-bar" class="navbar navbar-default navbar-fixed-top">
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="/">Notebook</a>
            </div>
            <div id="navbar" class="navbar-collapse collapse">
                <ul class="nav navbar-nav">
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">architecture <span class="caret"></span></a>
                                                        <!-- NavBarMenu Start -->
                            <ul class="dropdown-menu">
                            <li class=""><a href="/architecture/CQRS.html">CQRS</a></li>
                            <li class=""><a href="/architecture/resources.html">Resources</a></li>
                            </ul>
                            <!-- NavBarMenu Start --> 
                    </li>
                </ul>
                <ul class="nav navbar-nav">
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">docker <span class="caret"></span></a>
                                                        <!-- NavBarMenu Start -->
                            <ul class="dropdown-menu">
                            <li class=""><a href="/docker/cheat-sheet.html">Cheat Sheet</a></li>
                            <li class=""><a href="/docker/on-windows.html">Docker On Windows</a></li>
                            <li class=""><a href="/docker/map-custom_folder-to-host.html">Map Custom Folder</a></li>
                            </ul>
                            <!-- NavBarMenu Start --> 
                    </li>
                </ul>
                <ul class="nav navbar-nav">
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">git <span class="caret"></span></a>
                                                        <!-- NavBarMenu Start -->
                            <ul class="dropdown-menu">
                            <li class=""><a href="/git/ssh-keys.html">SSH Key Generation</a></li>
                            <li class=""><a href="/git/ssh-key-per-host.html">SSH Key Per Host</a></li>
                            </ul>
                            <!-- NavBarMenu Start --> 
                    </li>
                </ul>
                <ul class="nav navbar-nav">
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">learning <span class="caret"></span></a>
                                                        <!-- NavBarMenu Start -->
                            <ul class="dropdown-menu">
                            <li class=""><a href="/learning/resources.html">Resources</a></li>
                            </ul>
                            <!-- NavBarMenu Start --> 
                    </li>
                </ul>
                <ul class="nav navbar-nav">
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">meta <span class="caret"></span></a>
                                                        <!-- NavBarMenu Start -->
                            <ul class="dropdown-menu">
                            <li class=""><a href="/meta/docker.html">Docker</a></li>
                            <li class=""><a href="/meta/todo.html">Todo</a></li>
                            </ul>
                            <!-- NavBarMenu Start --> 
                    </li>
                </ul>
                <ul class="nav navbar-nav">
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">ops <span class="caret"></span></a>
                                                        <!-- NavBarMenu Start -->
                            <ul class="dropdown-menu">
                            <li class=""><a href="/ops/machine-bootsrap.html">Machine Bootstrap</a></li>
                            <li class=""><a href="/ops/resources.html">Resources</a></li>
                            </ul>
                            <!-- NavBarMenu Start --> 
                    </li>
                </ul>
                <ul class="nav navbar-nav">
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">raspberry-pi <span class="caret"></span></a>
                                                        <!-- NavBarMenu Start -->
                            <ul class="dropdown-menu">
                            <li class=""><a href="/raspberry-pi/sd-cards.html">SD Cards</a></li>
                            </ul>
                            <!-- NavBarMenu Start --> 
                    </li>
                </ul>
                <ul class="nav navbar-nav">
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">synology <span class="caret"></span></a>
                                                        <!-- NavBarMenu Start -->
                            <ul class="dropdown-menu">
                            <li class=""><a href="/synology/crash-plan.html">CrashPlan</a></li>
                            <li class=""><a href="/synology/git.html">Git Backup</a></li>
                            <li class=""><a href="/synology/gmvault.html">GMail Backup (GMVault)</a></li>
                            <li class=""><a href="/synology/notifications.html">Notifications</a></li>
                            <li class=""><a href="/synology/plex.html">Plex</a></li>
                            <li class=""><a href="/synology/restore.html">Restore Plan</a></li>
                            <li class=""><a href="/synology/ssh.html">SSH</a></li>
                            <li class=""><a href="/synology/vpn.html">VPN</a></li>
                            </ul>
                            <!-- NavBarMenu Start --> 
                    </li>
                </ul>
                <ul class="nav navbar-nav">
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">testing <span class="caret"></span></a>
                                                        <!-- NavBarMenu Start -->
                            <ul class="dropdown-menu">
                            <li class=""><a href="/testing/BDD.html">BDD</a></li>
                            <li class=""><a href="/testing/current-thinking.html">Current thinking</a></li>
                            <li class=""><a href="/testing/resources.html">Resources</a></li>
                            </ul>
                            <!-- NavBarMenu Start --> 
                    </li>
                </ul>
                <ul class="nav navbar-nav">
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">tooling <span class="caret"></span></a>
                                                        <!-- NavBarMenu Start -->
                            <ul class="dropdown-menu">
                            <li class=""><a href="/tooling/tfs.html">TFS</a></li>
                            <li class=""><a href="/tooling/video.html">Video</a></li>
                            </ul>
                            <!-- NavBarMenu Start --> 
                    </li>
                </ul>
                <ul class="nav navbar-nav">
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">web-development <span class="caret"></span></a>
                                                        <!-- NavBarMenu Start -->
                            <ul class="dropdown-menu">
                            <li class=""><a href="/web-development/angular.html">Angular 2</a></li>
                            <li class=""><a href="/web-development/npm.html">NPM</a></li>
                            <li class=""><a href="/web-development/resources.html">Resources</a></li>
                            </ul>
                            <!-- NavBarMenu Start --> 
                    </li>
                </ul>
            </div>
        </div>
    </nav>

<div class="container">

    <div class="row">
        <div class="col-md-9">
            <h3>GMail Backup (GMVault)</h3>
            <hr />
        <p>Install Python 2.7 package from the package centre</p>
<p>Setup the directory structure to run GMVault from</p>
<p>Create an isolated Python virtual environment to run GMVault from. Blogs recommended using a specific version of python virtual environment as the lastest version on GitHub apparently had issues as of Jan 2015</p>
<pre><code class="language-bash">cd GMVault
wget https://pypi.python.org/packages/source/v/virtualenv/virtualenv-1.10.1.tar.gz
tar xzf virtualenv-1.10.1.tar.gz
python ./virtualenv-1.10.1/virtualenv.py gmvault_env
</code></pre>
<p>Install GMVault using the python package manager - requesting pre-requsites from within the new virutal environment</p>
<pre><code class="language-bash">cd gmvault_env/bin
./activate
./pip install --pre gmvault
</code></pre>
<p>Test out the GMVault installation, note as Synology doesn't have a bash shell you need to run it explicitly using sh - you should get some output complaining about missing arguments</p>
<pre><code class="language-bash">sh ./gmvault
</code></pre>
<p>Being logged in as the user you will run the backup regularly as do a test backup - this will setup the authentication with GMail using OAuth. This same trick can also be used if the authentication starts failing for some reason e.g. when google moved to only support OAuth v2. First you will need to remove any cached auth tokens from $HOME/.gmvault and then run the command</p>
<pre><code class="language-bash">sh ./gmvault sync &lt;email address&gt;
</code></pre>
<p>Hit enter when it says it will open a browser, this will fail but a link will be displayed that you can use to setup the OAuth autorisation.</p>
<p>After that you should be good to go ahead with the backups</p>
<h3 id="sample-script">Sample script</h3>
<pre><code class="language-bash">#!/bin/sh
 
NOW=$(date +&quot;%Y%m%d%H%M&quot;)
LOGFILE=&quot;/volume1/Data/Backup/Log/email&#64;domain-$NOW.log&quot;
CURTIME=$(date +&quot;%r&quot;)
 
echo &quot;------------------------------------&quot; &gt;&gt; $LOGFILE
echo &quot;$CURTIME: Starting email sync...&quot; &gt;&gt; $LOGFILE
echo &quot;------------------------------------&quot; &gt;&gt; $LOGFILE
printf &quot;\n&quot; &gt;&gt; $LOGFILE
 
whoami &gt;&gt; $LOGFILE
set &gt;&gt; $LOGFILE
 
cd /var/services/homes/admin
/volume1/Data/Backup/GMail/GMVault/gmvault_env/bin/activate
sh /volume1/Data/Backup/GMail/GMVault/gmvault_env/bin/gmvault sync -t full -d /volume1/Data/Backup/GMail/ emailaddress &gt;&gt; $LOGFILE 2&gt;&amp;1
 
CURTIME=$(date +&quot;%r&quot;)
 
printf &quot;\n&quot; &gt;&gt; $LOGFILE
echo &quot;------------------------------------&quot; &gt;&gt; $LOGFILE
echo &quot;$CURTIME: email sync finished.&quot; &gt;&gt; $LOGFILE
echo &quot;------------------------------------&quot; &gt;&gt; $LOGFILE
</code></pre>
<p>To update gmvault to the latest version use pip</p>
<pre><code class="language-bash">cd /volume1/Data/Backup/GMail/GMVault/gmvault_env/bin
./pip install -U gmvault
</code></pre>
<p><strong>References</strong></p>
<ul>
<li><a href="http://workingconcept.com/blog/synology-gmail-backup">http://workingconcept.com/blog/synology-gmail-backup</a></li>
<li><a href="http://jimmybonney.com/articles/install_gmvault_on_a_synology_nas_follow_up/">http://jimmybonney.com/articles/install_gmvault_on_a_synology_nas_follow_up/</a></li>
</ul>

        </div>
        <div class="col-md-3">
            <nav id="toc" data-toggle="toc" data-spy="affix"></nav>
        </div>
    </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="text-muted">Craig Paton</p>
  </div>
</footer>

</body>
<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
<script src="/js/jquery-3.1.0.min.js"></script>
<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="/js/bootstrap.min.js"></script>

<script src="/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

<link rel="stylesheet" href="/css//bootstrap-toc.min.css">
<script src="/js/bootstrap-toc.min.js"></script>

<script lang="javascript">
(function($){
    $(document).ready(function(){
        $('ul.dropdown-menu [data-toggle=dropdown]').on('click', function(event) {
            event.preventDefault(); 
            event.stopPropagation(); 
            $(this).parent().siblings().removeClass('open');
            $(this).parent().toggleClass('open');
        });
    });
})(jQuery);
</script>

<script lang="javascript">
$('body').scrollspy({ 
    target: '#toc', offset: 110
})
</script>

<script src="/js/anchor-fix.js"></script>
</html>